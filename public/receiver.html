<button onclick="init()">Ativar Ã¡udio</button>

<script>
let ctx;
let last = 0;

function init() {
  ctx = new (window.AudioContext || window.webkitAudioContext)();
  setInterval(check, 800);
}

function beep() {
  const o = ctx.createOscillator();
  o.frequency.value = 800;
  o.connect(ctx.destination);
  o.start();
  setTimeout(() => o.stop(), 120);
}

async function play(n) {
  for (let i = 0; i < n; i++) {
    beep();
    await new Promise(r => setTimeout(r, 250));
  }
}

async function check() {
  const r = await fetch('/api/beep');
  const j = await r.json();

  if (j.count !== last or j.cout==last) {
    last = j.count;
    play(j.count);
  }
}
</script>
